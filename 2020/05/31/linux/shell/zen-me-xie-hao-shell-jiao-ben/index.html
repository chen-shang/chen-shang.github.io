<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="怎么写好Shell脚本, IT,技术,总结">
    <meta name="description" content="本人在写Shell脚本的过程中形成了自己一些规范,这些规范仍在实践中,在此分享出来。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>怎么写好Shell脚本 | 涓涓细流</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="涓涓细流" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">涓涓细流</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
<!--
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
-->
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">涓涓细流</div>
        <div class="logo-desc">
            
            无限可能
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/12.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">怎么写好Shell脚本</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%8E%9F%E5%88%9B/">
                                <span class="chip bg-color">原创</span>
                            </a>
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                            <a href="/tags/%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD/">
                                <span class="chip bg-color">未完待续</span>
                            </a>
                        
                            <a href="/tags/Shell/">
                                <span class="chip bg-color">Shell</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Linux/" class="post-category">
                                Linux
                            </a>
                        
                            <a href="/categories/Linux/Shell/" class="post-category">
                                Shell
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-05-31
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-09-19
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    38 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="序"><a class="markdownIt-Anchor" href="#序"></a> 序</h1>
<p>Shell脚本实在是太灵活了,相比标准的Java、C、C++ 等,它不过是一些现有命令的堆叠,这是他的优势也是他的劣势,太灵活导致不容易写规范。本人在写Shell脚本的过程中形成了自己一些规范,这些规范仍在实践中,在此分享出来。</p>
<h1 id="shell介绍"><a class="markdownIt-Anchor" href="#shell介绍"></a> Shell介绍</h1>
<p>Shell中文译名叫 壳(ke,又读qiao) 外壳的意思,有壳就要有核.核指的是内核,内核即操作系统<strong>内</strong>的<strong>核</strong>心代码,内核是操作系统对计算机硬件资源(例如显示器、硬盘、内存等等)进行调度的唯一通道,也就是说所有对计算机发出的指令,例如使蜂鸣器鸣响、点亮键盘背光、复制粘贴等等都需要经过内核来操作才行,这无论如何你是跨越不过去的。而Shell则是包裹在内核之外的一层壳,通过Shell我们可以方便的操控系统的软硬件,体现就是我们使用的一个个的命令或工具,都是Shell这层壳的范畴。</p>
<p>上面说了Shell是一些工具的集合,但同时Shell也是一门语言。就像Java一样,既是一些工具（jar包）的集合,也是一种编程语言。既然是语言就要选择是哪个阵营：解释型还是编译型。Shell选择了解释型,C语言选择了编译型,Java既选择了编译又选择了解释。既然是一种解释型语言,就需要解释器来解释执行。历史上出现过很多Shell解释器,例如 sh,bash,csh,zsh 等等,不同的Shell解释器有不同的词法和语法,就好比不同的方言。用不同的Shell其实指的仅仅是更换了脚本解释器而已。要注意的是有些命令在不同的解释器中会有不同的表现,这也是为什么我们的脚本一移植到别人电脑上就不可用的原因之一。</p>
<p>举两个例子<br>
坑一:echo 在 zsh 和其他 Shell解释器中对特殊字符转义的输出就不同。如果不分清具体使用的是哪个Shell,很有可能就落坑里还不知道原因。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ <span class="token function">bash</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token punctuation">\</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token punctuation">\</span><span class="token punctuation">\</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ <span class="token function">zsh</span>
chenshangMacBook-Pro% <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token punctuation">\</span>
chenshangMacBook-Pro% <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token punctuation">\</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>坑二: 数组使用方式也不同</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ <span class="token function">bash</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token builtin class-name">echo</span> <span class="token variable">${a}</span>
<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ <span class="token function">zsh</span>
chenshangMacBook-Pro% <span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span>
chenshangMacBook-Pro% <span class="token builtin class-name">echo</span> <span class="token variable">${a}</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
chenshangMacBook-Pro%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>总之,Shell脚本中的坑很多,林林总总,写脚本的时候一定要小心,否则脚本的移植性堪忧。这也就是为什么Shell不适合开发大型应用的原因之一。但辅助开发还是绰绰有余的。尤其是在运维服务器和对文本处理的过程中,与linux的亲和性让它占尽了优势。</p>
<p>本Shell规约是以bash为标准,在Mac OS 10.14上进行验证。所有命令和脚本都是依托bash这个解释器来执行的,我用bash的原因主要就是因为bash是发展比较早的解释器,后续发展的各种解释器如 zsh\csh 多多少少都兼容bash。不过,同时也无法使用其他Shell的高级特性。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ sw_vers
ProductName: Mac OS X
ProductVersion: <span class="token number">10.14</span>
chenshang@chenshangMacBo    ok-Pro:~$ <span class="token function">uname</span> <span class="token parameter variable">-a</span>
BuildVersion: 18A391Darwin chenshangMacBook-Pro.local <span class="token number">18.0</span>.0 Darwin Kernel Version <span class="token number">18.0</span>.0: Wed Aug <span class="token number">22</span> <span class="token number">20</span>:13:40 PDT <span class="token number">2018</span><span class="token punctuation">;</span> root:xnu-4903.201.2~1/RELEASE_X86_64 x86_64
chenshang@chenshangMacBook-Pro:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$0</span>
<span class="token parameter variable">-bash</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token environment constant">SHELL</span>}</span>
/usr/local/bin/bash
chenshang@chenshangMacBook-Pro:~$ <span class="token function">bash</span> <span class="token parameter variable">-version</span>
GNU bash, version <span class="token number">5.0</span>.2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>-release <span class="token punctuation">(</span>x86_64-apple-darwin18.2.0<span class="token punctuation">)</span>
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2019</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">&gt;</span>

This is <span class="token function">free</span> software<span class="token punctuation">;</span> you are <span class="token function">free</span> to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>既然Shell他是一门语言就免不了两大要素:词法和语法,首先有哪些词汇(保留词、关键字),词汇有哪些分类(数据类型),其次这些词汇如何表达语意(也就是语法)。Shell编程指的并不是编写这个工具,而是指利用现有的Shell工具进行编程,写出来的程序是轻量级的脚本,我们叫做Shell脚本。Shell的语法是从C继承过来的,因此我们在写Shell脚本的时候往往能看到C语言的影子。因为初代Unix内核中的Shell解释器最主要的两个贡献者一个是肯汤普森,另一个是丹尼斯里奇,而丹尼斯里奇是C语言的发明者,肯汤普森则用C语言重写了之前的Unix内核。</p>
<h1 id="基础语法"><a class="markdownIt-Anchor" href="#基础语法"></a> 基础语法</h1>
<h2 id="说明"><a class="markdownIt-Anchor" href="#说明"></a> 说明</h2>
<p>写Shell脚本考验是的你对各个命令或工具使用的熟练程度。基本命令必须要熟练掌握,常用命令要知道基本功能和基本参数,生僻命令只需要知道大概即可,要学会使用man手册查看命令的帮助文档。对于一些命令不必死记硬背,用的时候查一下解决问题即可。</p>
<p>基本命令例如 /bin 目录下的</p>
<pre class="line-numbers language-terminal" data-language="terminal"><code class="language-terminal">chenshang@chenshangMacBook-Pro:~$ ls /bin/
[         chmod     date      echo      hostname  launchctl ls        pax       rm        sleep     tcsh      wait4path
bash      cp        dd        ed        kill      link      mkdir     ps        rmdir     stty      test      zsh
cat       csh       df        expr      ksh       ln        mv        pwd       sh        sync      unlink<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>常用命令和工具</p>
<blockquote>
<p>sed、awk、grep、tr、column、jq、ssh、scp、expect、ps、top、htop、tree、pstree、curl、wget、java 相关的工具</p>
</blockquote>
<p>一些冷门工具</p>
<blockquote>
<p>lolcat、lsof、tree、tac</p>
</blockquote>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】Linux工具的使用不必死记硬背,不必死记硬背,不必死记硬背,即查即用即可 </font><br></p>
</blockquote>
<h2 id="运行方式"><a class="markdownIt-Anchor" href="#运行方式"></a> 运行方式</h2>
<p>既可以在命令行交互的运行,又可以将指令固化到文件中执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chenshang@chenshangMacBook-Pro:~$ <span class="token function">cat</span> test.sh
<span class="token comment">#!/bin/zsh</span>
<span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${array}</span>"</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token function">sh</span> test.sh
<span class="token punctuation">\</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token function">zsh</span> test.sh
<span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token number">1</span>
chenshang@chenshangMacBook-Pro:~$ <span class="token function">chmod</span> u+x test.sh
chenshang@chenshangMacBook-Pro:~$ ll test.sh
-rw-rw-rw-  <span class="token number">1</span> chenshang  staff    <span class="token number">40</span> Feb <span class="token number">18</span> <span class="token number">17</span>:32 test.sh
chenshang@chenshangMacBook-Pro:~$ ./test.sh
<span class="token punctuation">\</span>
<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
chenshang@chenshangMacBook-Pro:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【推荐】脚本以均<code>.sh</code>结尾,使人可以一目了然知道该文件是脚本文件 </font><br></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【推荐】脚本执行建议明确指定解析器,这样可以不用每个文件都单独赋予可执行权限 </font><br></p>
</blockquote>
<p>如果要固化到文件中,那我们的脚本该怎么写呢？</p>
<h2 id="关于首行"><a class="markdownIt-Anchor" href="#关于首行"></a> 关于首行</h2>
<blockquote>
<p><font color="#dd0000">【推荐】推荐使用 <code>#!/usr/bin/env bash</code> 作为 shebang </font><br></p>
</blockquote>
<p>我们往往看到大多数Shell脚本的第一行是 <code>#!/bin/bash</code> 这句话,当然也有 <code>#!/bin/sh</code>、<code>#!/usr/bin/bash</code>,这几种写法也都算是正确,当然还有一些野路子的写法,为了避免误导这里就不示例了。本Shell规约并不推荐使用上面的任何一种,而是使用 <code>#!/usr/bin/env bash</code> 这种。</p>
<p>首行关系到运行脚本的时候究竟使用哪种Shell解释器。这也说明Shell是一种解释性语言,脚本从上到下每读一行就执行一行,在遇到第一行是 <code>#!/bin/bash</code> 的时候就会加载 bash 相关的环境,在遇到 <code>#!/bin/sh</code> 就会加载 sh 相关的环境,避免在执行脚本的时候遇到意想不到的错误。但一开始我并不知道我电脑上安装了哪些Shell,默认使用的又是哪一个Shell,我脚本移植到别人的计算机上执行,我更不可能知道别人的计算机是Ubuntu还是Arch或是Centos。为了提高程序的移植性,本Shell规约规定使用 <code>#!/usr/bin/env bash</code>, <code>#!/usr/bin/env bash</code> 会自己判断使用的Shell是目录在哪,并加载相应的环境变量。</p>
<p>首行只在没有明确指定使用哪个Shell解释器的时候才起作用,如果执行脚本的时候指定了具体是用bash还是zsh还是csh,那第一行中定义的shell解释器将不再有用。</p>
<p>举几个例子,顺便学习一下shellchek工具</p>
<p>我们看一下下面一段脚本,在改变第一行头部的时候,shellcheck给出的建议是什么。shellckek 类似我们在idea里面安装的语法检查工具。它会提示我们脚本中有哪些地方写的不够规范。<br>
$ cat <a target="_blank" rel="noopener" href="http://jsons.sh">jsons.sh</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>
<span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${array}</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>不使用首行的时候</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">In test.sh line 1:
echo \\\\
^-- SC2148: Tips depend on target shell and yours is unknown. Add a shebang.


In test.sh line 3:
echo "${array}"
    ^------^ SC2128: Expanding an array without an index only gives the first element.

For more information:
https://www.shellcheck.net/wiki/SC2148 -- Tips depend on target shell and y...
https://www.shellcheck.net/wiki/SC2128 -- Expanding an array without an ind...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 #!/bin/bash 或 #!/usr/bin/env bash</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">In test.sh line 4:
echo "${array}"
    ^------^ SC2128: Expanding an array without an index only gives the first element.

For more information:
https://www.shellcheck.net/wiki/SC2128 -- Expanding an array without an ind...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 #!/bin/zsh</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">In test.sh line 1:
#!/bin/zsh
^-- SC1071: ShellCheck only supports sh/bash/dash/ksh scripts. Sorry!

For more information:
https://www.shellcheck.net/wiki/SC1071 -- ShellCheck only supports sh/bash/...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 #!/bin/sh</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">In test.sh line 3:
array=(1 2 3)
    ^-----^ SC2039: In POSIX sh, arrays are undefined.


In test.sh line 4:
echo "${array}"
    ^------^ SC2128: Expanding an array without an index only gives the first element.

For more information:
https://www.shellcheck.net/wiki/SC2039 -- In POSIX sh, arrays are undefined.
https://www.shellcheck.net/wiki/SC2128 -- Expanding an array without an ind...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这一行不写大多数时候我们运行脚本的时候也没有问题,但在使用shellcheck进行静态代码检查的时候,会提示</p>
<blockquote>
<p>^-- SC2148: Tips depend on target Shell and yours is unknown. Add a shebang.</p>
</blockquote>
<p>如果使用Intellij IDEA 也会提示 <code>add shebang line</code></p>
<p>当你点击 <code>Add shebangline</code> 的时候它会自动添加 <code>#!/usr/bin/env bash</code> ,这也是为什么本Shell规约推荐使用 <code>#!/usr/bin/env bash</code> 的原因之一。</p>
<h3 id="shebang-维基百科"><a class="markdownIt-Anchor" href="#shebang-维基百科"></a> shebang 维基百科</h3>
<blockquote>
<p>在计算机科学中,Shebang（也称为 Hashbang ）是一个由井号和叹号构成的字符序列 #! ,其出现在文本文件的第一行的前两个字符。 在文件中存在 Shebang 的情况下,类 Unix 操作系统的程序载入器会分析 Shebang 后的内容,将这些内容作为解释器指令,并调用该指令,并将载有 Shebang 的文件路径作为该解释器的参数[1]。\n<br>
例如,以指令<code>#!/bin/sh</code>开头的文件在执行时会实际调用 <code>/bin/sh</code> 程序（通常是 Bourne Shell 或兼容的 Shell,例如 bash、dash 等）来执行。这行内容也是 Shell 脚本的标准起始行。</p>
</blockquote>
<p>首行写完之后,就要正式写我们的代码了。我们学Java的时候第一件事情就是学习Java的8种基本数据类型。我们学Shell也一样,先看这门语言支持哪些数据类型。对于比Java这种强类型的语言,Shell是一门弱类型语言,Shell可以说只有两类数据类型 字符串 &amp; 数组。</p>
<h2 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型"></a> 数据类型</h2>
<h3 id="字符串"><a class="markdownIt-Anchor" href="#字符串"></a> 字符串</h3>
<p>无论输入的是字符串还是数字,Shell都是按照字符串类型来进行存储的(也就是说Shell无法显示定义一个 bit、short、int、long、float、double、boolean、char),具体属于什么数据类型,shell会根据上下文或操作符自行确定。</p>
<p>字符串可以用单引号,也可以用双引号,也可以不用引号。单双引号的区别跟PHP类似。区别</p>
<ol>
<li>``单引号里的任何字符都会原样输出,单引号字符串中的变量是无效的；</li>
<li>``单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行）,但可成对出现,作为字符串拼接使用。</li>
<li>""双引号里可以有变量(这在编程语言里面叫字符串插值)和转义字符</li>
</ol>
<h3 id="shell数组"><a class="markdownIt-Anchor" href="#shell数组"></a> Shell数组</h3>
<h4 id="定义数组"><a class="markdownIt-Anchor" href="#定义数组"></a> 定义数组</h4>
<p>bash支持一维数组（不支持多维数组）,并且没有限定数组的大小。类似于 C 语言,数组元素的下标由 0 开始编号。获取数组中的元素要利用下标,下标可以是整数或算术表达式,其值应大于或等于 0。在 Shell 中,用括号来表示数组,数组元素用"空格"符号分割开。</p>
<p>定义数组的一般形式为:数组名=(值1 值2 … 值n).例如:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span>value0 value1 value2 value3<span class="token punctuation">)</span>
<span class="token comment"># 或者</span>
<span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span>
value0
value1
value2
value3
<span class="token punctuation">)</span>
<span class="token comment"># 还可以单独定义数组的各个分量:</span>
array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>value0
array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>value1
array<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">=</span>valueN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以不使用连续的下标,而且下标的范围没有限制。</p>
<h4 id="读取数组"><a class="markdownIt-Anchor" href="#读取数组"></a> 读取数组</h4>
<blockquote>
<p><font color="#dd0000"> 读取数组元素值的一般格式是:<code>${数组名[下标]}</code>。</font><br><br>
例如:valuen=${array[n]}<br>
使用 @ 或 * 符号可以获取数组中的所有元素。<br>
例如:<code>echo ${array[@]}</code>, <code>echo ${array[*]}</code></p>
</blockquote>
<h4 id="数组长度"><a class="markdownIt-Anchor" href="#数组长度"></a> 数组长度</h4>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">取得数组元素的个数
length=${#array[@]}
或者
length=${#array[*]}
取得数组单个元素的长度
lengthn=${#array[n]}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】传递数组使用 “${list[*]}” 形式 </font><br></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】接收数组使用 array=($*) 形式 </font><br></p>
</blockquote>
<p>示例:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @return the number of elements in this list</span>
<span class="token keyword">function</span> <span class="token function-name function">list_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token builtin class-name">local</span> <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token variable">${<span class="token operator">#</span>array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${size}</span>"</span>
<span class="token punctuation">}</span>
<span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>list_size <span class="token string">"<span class="token variable">${list<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>"</span><span class="token variable">)</span></span>
assertEquals <span class="token string">"<span class="token variable">${size}</span>"</span> <span class="token string">"2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>知道了数据类型,我们看怎么定义变量呢?</p>
<h2 id="shell变量"><a class="markdownIt-Anchor" href="#shell变量"></a> Shell变量</h2>
<h3 id="变量类型"><a class="markdownIt-Anchor" href="#变量类型"></a> 变量类型</h3>
<p>Shell里面的变量分为 局部变量、环境变量。</p>
<ol>
<li>局部变量 局部变量在脚本或命令中定义,仅在当前shell实例中有效,其他shell启动的程序不能访问局部变量。</li>
<li>环境变量 所有的程序,包括shell启动的程序,都能访问环境变量,有些程序需要环境变量来保证其正常运行。</li>
</ol>
<p>本shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【推荐】不要定义与环境变量重名的局部变量,会改变环境变量的值,进而影响后续脚本的执行。</font><br></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【推荐】如果要打破上一个推荐,修改后及时修改回来。例如 IFS 代表分隔符的情况。</font><br></p>
</blockquote>
<h3 id="变量定义"><a class="markdownIt-Anchor" href="#变量定义"></a> 变量定义</h3>
<p>基本形式 <code>变量=变量值</code></p>
<p>本shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】变量名和等号之间不能有空格,这可能和你熟悉的所有编程语言都不一样。</font><br></p>
</blockquote>
<h3 id="变量取值"><a class="markdownIt-Anchor" href="#变量取值"></a> 变量取值</h3>
<blockquote>
<p><font color="#dd0000">【强制】变量取值用 “${}”, 使用 {} 包裹,给所有变量加上花括号,防止产生歧义 </font><br></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】变量取值用 “${}”, 使用 “” 包裹,防止分词 </font><br></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】若需要将调用的函数的返回结果赋值给local变量,使用 $(),不推荐使用 `` </font><br></p>
</blockquote>
<h3 id="变量作用域"><a class="markdownIt-Anchor" href="#变量作用域"></a> 变量作用域</h3>
<p>局部变量如果不明确变量的作用域则默认是全局可见的,也就是一个变量从定义它的位置开始到脚本的最后一行,一直是可以访问的,即使是在函数里面定义的,在函数外面也是可以访问的。这一点和我们用的Java是不一样的。Java在大括号内定义的变量只能在大括号内可见。如果想要实现在大括号的的作用于可见的变量,我们必须显示的用local关键字修饰。例如</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token number">1</span>           <span class="token comment">#全局变量</span>
<span class="token keyword">function</span> <span class="token function-name function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token number">2</span>         <span class="token comment">#全局变量</span>
<span class="token assign-left variable">b</span><span class="token operator">=</span><span class="token number">3</span>         <span class="token comment">#全局变量</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">c</span><span class="token operator">=</span><span class="token number">2</span>   <span class="token comment">#局部变量</span>
<span class="token punctuation">}</span>
f1            <span class="token comment">#这里得先调用一下</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${a}</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${b}</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${c}</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>a 在函数外面定义,系全局作用域；在f1里面改变了a的值,同时定义了一个全局作用域的变量b ,和一个 函数作用域的变量c。 所以 b 在大括号外是可以被访问的,但是c却不能被访问。</p>
<p>本shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【推荐】能缩小变量作用域的就缩小变量的作用域,也就是能用local的就用local修饰</font></p>
</blockquote>
<h3 id="只读变量"><a class="markdownIt-Anchor" href="#只读变量"></a> 只读变量</h3>
<p>使用 readonly 命令可以将变量定义为只读变量,只读变量的值不能被改变。</p>
<p>本shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】认定为常量的必须用readonly修饰,相当于 Java 中的final</font></p>
</blockquote>
<h3 id="删除变量"><a class="markdownIt-Anchor" href="#删除变量"></a> 删除变量</h3>
<p>使用 unset 命令可以删除变量,变量被删除后不能再次使用。unset 命令不能删除只读变量。</p>
<p>本shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【推荐】删除变量能不用就不用,一般没什么应用场景</font></p>
</blockquote>
<h2 id="关于注释"><a class="markdownIt-Anchor" href="#关于注释"></a> 关于注释</h2>
<p>除脚本首行外,所有以 <code>#</code> 开头的语句都将成为注释。</p>
<p>示例:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 主函数 []&lt;-()                   &lt;-------函数注释这样写</span>
<span class="token keyword">function</span> <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token string">"Hello World!!!"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${var}</span>"</span>
<span class="token punctuation">}</span>
<span class="token comment"># info级别的日志 []&lt;-(msg:String)  &lt;-------带入参的函数注释</span>
<span class="token function-name function">log_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%dT%H:%M:%S%z'</span><span class="token variable">)</span></span>][<span class="token variable">$$</span>]: [info] <span class="token variable">$*</span>"</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
<span class="token punctuation">}</span>
<span class="token comment"># error级别的日志 []&lt;-(msg:String) &lt;-------带入参的函数注释</span>
<span class="token function-name function">log_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment"># todo [error]用红色显示         &lt;------函数内注释</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token variable">$1</span> <span class="token comment">#将要输出的日志内容  &lt;------变量的注释紧跟在变量的后面</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> x<span class="token string">"<span class="token variable">${msg}</span>"</span> <span class="token operator">!=</span> x<span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
  <span class="token comment"># 注释                        &lt;-------函数内注释 `#` 与缩进格式对整齐</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"[<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%dT%H:%M:%S%z'</span><span class="token variable">)</span></span>][<span class="token variable">$$</span>]:[error] <span class="token variable">$*</span>"</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
<span class="token keyword">fi</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】函数需有注释标识该函数的用途、入参变量、函数的返回值类型</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】函数的注释 <code>#</code> 顶格写, 井号后面紧跟一个空格<br>
说明: 对于该格式的要求是为了最后生成函数的帮助文档是用的(markdown语法),然后是注释的内容,注释尽量简短且在一行,最后跟的是函数的类型。</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】函数内注释 <code>#</code> 与缩进格式对整齐</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】变量的注释紧跟在变量的后面,不推荐换行写注释</font></p>
</blockquote>
<h2 id="关于函数"><a class="markdownIt-Anchor" href="#关于函数"></a> 关于函数</h2>
<p>函数定义的形式是</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">#函数执行的操作</span>
<span class="token comment">#函数的返回结果</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>或</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">#函数执行的操作</span>
<span class="token comment">#函数的返回结果</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000"> 【强制】认定为常函数的必须用readonly修饰,相当于 Java 中的final。</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000"> 【推荐】使用关键字 <code>function</code> 显示定义的函数为 public 的函数,可以供 外部脚本以 <code>sh 脚本 函数 函数入参</code> 的形式调用,可以认为成Java当中的public的方法</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000"> 【推荐】未使用关键字 <code>function</code> 显示定义的函数为 private 的函数, 仅供本脚本内部调用,可以认为成Java中的私有方法,注意这种private是人为规定的,并不是Shell的语法,不推荐以 &gt; <font color="#dd0000"> <code>sh 脚本 函数 函数入参</code> 的形式调用,注意是不推荐而不是不能。</font></font></p>
</blockquote>
<p>说明:本Shell规约这样做的目的就在于使脚本具有一定的封装性,看到 <code>function</code> 修饰的就知道这个函数能被外部调用, 没有被修饰的函数就仅供内部调用。你就知道如果你修改的函数的影响范围. 如果是 被function 修饰的函数,修改后可能影响到外部调用他的脚本, 而修改未被function修饰的函数的时候,仅仅影响本文件中其他函数。</p>
<p>如 <a target="_blank" rel="noopener" href="http://core.sh">core.sh</a> 脚本内容如下是</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 重新设置DNS地址 []&lt;-()</span>
<span class="token keyword">function</span> <span class="token function-name function">setNameServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
log_info <span class="token string">"setNameServer is ok"</span>
<span class="token punctuation">}</span>
<span class="token comment"># info级别的日志 []&lt;-(msg:String)</span>
<span class="token function-name function">log_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"[<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%dT%H:%M:%S%z'</span><span class="token variable">)</span></span>][<span class="token variable">$$</span>]: <span class="token entity" title="\033">\033</span>[32m [info] <span class="token entity" title="\033">\033</span>[0m <span class="token variable">$*</span>"</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
<span class="token punctuation">}</span>
<span class="token comment"># error级别的日志 []&lt;-(msg:String)</span>
<span class="token function-name function">log_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment"># todo [error]用红色显示</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"[<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%dT%H:%M:%S%z'</span><span class="token variable">)</span></span>][<span class="token variable">$$</span>]: <span class="token entity" title="\033">\033</span>[31m [error] <span class="token entity" title="\033">\033</span>[0m <span class="token variable">$*</span>"</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>则我可以使用 <code>sh core.sh setNameServer</code> 的形式调用  <code>set_name_server</code> 函数,<br>
但就不推荐使用 <code>sh core.sh log_info "Hello World"</code> 的形式使用 <code>log_info</code> 和 <code>log_error</code> 函数,注意是不推荐不是不能。</p>
<h3 id="函数调用"><a class="markdownIt-Anchor" href="#函数调用"></a> 函数调用</h3>
<p>变量、函数调用必须在函数声明之后,也就是说在用一个函数的时候,这一行命令的前面必须出现了该函数,因为Shell的执行是从上向下解释执行的。</p>
<p>为了能够调用另一个脚本中的方法，我们可以使用source关键字加载一下该脚本，source 相当于java中的import。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">source</span> ./<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/BaseShell/Log/BaseLog.sh
<span class="token keyword">function</span> <span class="token function-name function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">echo</span> <span class="token string">"I am f1"</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
log_info <span class="token string">"LINENO:<span class="token variable">${LINENO}</span> 开始执行"</span>      <span class="token comment">#调用 ./../../BaseShell/Log/BaseLog.sh 中的函数,需要先用source BaseLog.sh</span>
f1                                      <span class="token comment">#在函数内部调用当前脚本内的函数</span>
log_success <span class="token string">"LINENO:<span class="token variable">${LINENO}</span> 结束执行"</span>   <span class="token comment">#调用 ./../../BaseShell/Log/BaseLog.sh 中的函数</span>
<span class="token punctuation">}</span>
main                                       <span class="token comment">#在脚本内部调用当前脚本内的函数</span>
<span class="token function">bash</span> ChangBaiShanFetcher.sh                <span class="token comment">#执行其他脚本</span>
<span class="token function">bash</span> ChangBaiShanFetcher.sh main           <span class="token comment">#执行其他脚本的main方法,前提是 ChangBaiShanFetcher.sh 脚本 支持按函数名调用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">【强制】将函数分门别类保存在不同的脚本中
【推荐】使用source的方式引入另一个脚本中的函数,不推荐使用`脚本 函数名 函数参数`的形式调用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="函数参数"><a class="markdownIt-Anchor" href="#函数参数"></a> 函数参数</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$#</code></td>
<td>传递到脚本或函数的参数个数</td>
<td></td>
</tr>
<tr>
<td><code>$*</code></td>
<td>以一个单字符串显示所有向脚本传递的参数。如<code>$*</code>用「"」括起来的情况、以<code>"$1 $2 … $n"</code>的形式输出所有参数。</td>
<td></td>
</tr>
<tr>
<td><code>$$</code></td>
<td>脚本运行的当前进程ID号</td>
<td></td>
</tr>
<tr>
<td><code>$!</code></td>
<td>后台运行的最后一个进程的ID号</td>
<td></td>
</tr>
<tr>
<td><code>$@</code></td>
<td>与<code>$*</code>相同,但是使用时加引号,并在引号中返回每个参数。如<code>"$@"</code>用「"」括起来的情况、以<code>"$1" "$2" … "$n"</code>的形式输出所有参数。</td>
<td></td>
</tr>
<tr>
<td><code>$-</code></td>
<td>显示Shell使用的当前选项,与set命令功能相同。</td>
<td></td>
</tr>
<tr>
<td><code>$?</code></td>
<td>显示最后命令的退出状态。0表示没有错误,其他任何值表明有错误。</td>
<td></td>
</tr>
</tbody>
</table>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000"> 【强制】 在函数内部首先使用有意义的变量名接受参数,然后在使用这些变量进行操作,禁止直接操作$1,$2等,除非这些变量只用一次</font></p>
</blockquote>
<h3 id="函数注释"><a class="markdownIt-Anchor" href="#函数注释"></a> 函数注释</h3>
<p>函数类型的概念是从函数编程语言中的概念偷过来的,Shell函数的函数类型指的是函数的输入到函数的输入的映射关系</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 主函数 []&lt;-()                  &lt;-------函数注释这样写</span>
<span class="token keyword">function</span> <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token string">"Hello World!!!"</span>
<span class="token builtin class-name">echo</span> <span class="token variable">${var}</span>
<span class="token punctuation">}</span>
<span class="token comment"># info级别的日志 []&lt;-(msg:String)  &lt;-------带入参的函数注释</span>
<span class="token function-name function">log_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%dT%H:%M:%S%z'</span><span class="token variable">)</span></span>][<span class="token variable">$$</span>]: [info] <span class="token variable">$*</span>"</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>说明:</p>
<blockquote>
<p>main函数的函数类型是 <code>[]&lt;-()</code> , <code>&lt;-</code> 左侧表的是函数的返回值类型 用<code>[]</code>包裹, 右侧是函数的参数类型 用<code>()</code>包裹,多个参数用 <code>,</code> 分隔,参数的描述是从 Scala 语言中偷过来, 先是参数名称 然后是参数类型 中间用<code>:</code>分隔</p>
</blockquote>
<blockquote>
<p>对于main函数的注释来说, <code>#</code> 顶格写,后面紧跟一个空格,其实这样写是遵循的markdown的语法, 后面再跟一个空格,然后是 <code>[]&lt;-()</code>,代表这个函数没有入参也没有返回值,这个函数的目的就是执行这个这个函数中的命令,但我不关心这个函数的返回值。也就是利用函数的副作用来完成我们想要的操作。</p>
</blockquote>
<blockquote>
<p>对于log_info 也是一样 不过 最后的函数类型是 <code>[]&lt;-(msg:String)</code> 代表入参是一个<code>String</code>类型的信息,然后也没有返回值。</p>
</blockquote>
<p>关于函数的返回值,我理解的函数的返回值有两种形式,一种是显示的return一种是隐式的echo</p>
<p>以下是几种常见的写法</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>-<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token operator">&lt;</span>-<span class="token punctuation">(</span>var1:String,var2:String<span class="token punctuation">)</span>
<span class="token punctuation">[</span>Boolean<span class="token punctuation">]</span><span class="token operator">&lt;</span>-<span class="token punctuation">(</span>var1:String,var2:Int<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>-<span class="token punctuation">(</span>var1:String<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="返回值"><a class="markdownIt-Anchor" href="#返回值"></a> 返回值</h3>
<p>Shell 函数的返回值比较复杂,获取函数的返回值又有多种方式.一般来说,一个函数内的所有标准输出都作为函数的返回值,注意是标准输出,不包含标准错误。<br>
我们先来说,我们执行一条命令的时候, 比如 pwd 正常情况下它输出的结果是 当前所处的目录</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Last login: Sat Jan 20 17:39:16 on ttys000
chenshang@chenshangMacBook-Pro:~$ pwd
/Users/chenshang<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意我说的是正常情况下,那异常情况下呢?输出的结果又是什么?输出的结果有可能五花八门!所以,Shell中必然有一种状态来标识一条命令是否执行成功,也就是命令执行结果的状态。那这种状态是怎么标识的,这就引出了Shell中一个反人类的规定,就是 0代表真、成功的含义。非零代表假、失败的含义。</p>
<p>所以 pwd 这条命令如果执行成功的话,命令的执行结果状态一定是0,然后返回值才是当前目录。如果这条命令执行失败的话,命令的执行结果状态一定不是0,有可能是1 代表命令不存在,然后输出 not found,也有可能执行结果状态是2 代表超时,然后什么也不输出。(不要以为pwd这种linux内带的命令就一定执行成功,有可能你拿到的就是一台阉割版的linux呢)</p>
<h4 id="显示return"><a class="markdownIt-Anchor" href="#显示return"></a> 显示return</h4>
<p>return 用来显示的返回函数的返回结果,例如</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查当前系统版本 [Integer]&lt;-()</span>
<span class="token keyword">function</span> <span class="token function-name function">checkVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">(</span>log_info <span class="token string">"check_version ..."</span><span class="token punctuation">)</span> <span class="token comment">#log_info是我写的工具类中的一个函数</span>
<span class="token builtin class-name">local</span> version <span class="token comment">#这里是先定义变量,在对变量进行赋值,我们往往是直接初始化,而不是像这样先定义在赋值,这里只是告诉大家可以这么用</span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">'s/.* ([0-9]+)\..*/\1/'</span> /etc/redhat-release<span class="token variable">)</span></span>
<span class="token punctuation">(</span>log_info <span class="token string">"centos version is <span class="token variable">${version}</span>"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">return</span> <span class="token string">"<span class="token variable">${version}</span>"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示的return结果,返回值只能是[0-255]的数值,常常用在状态判断的时候。所以这个return有点像我们定义的异常（异常code,异常msg）.code=0,则代表命令执行成功,code!=0代表异常,异常msg通过标准错误输出。</p>
<p>这样这个函数的返回值是一个数值类型,我在脚本的任何地方调用 checkVersion 这个函数后,使用 $? 获取返回值</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">checkVersion
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable">$?</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${version}</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意这里不用 <code>version=$(check_version)</code> 这种形式获取结果,这样也是获取不到结果的</p>
<p>本Shell规约规定:</p>
<blockquote>
<p><font color="#dd0000"> 【推荐】不推荐使用return方式返回,推荐使用echo方式返回结果</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000"> 【推荐】返回结果类型是Boolean类型,也就是说函数的功能是起判断作用,返回结果是真或者假的时候使用才显示 return 返回结果</font></p>
</blockquote>
<p>例如</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查网络 [Boolean]&lt;-()</span>
<span class="token keyword">function</span> <span class="token function-name function">check_network</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">(</span>log_info <span class="token string">"check_network ..."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token keyword">do</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">http_code</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-I</span> <span class="token parameter variable">-m</span> <span class="token number">10</span> <span class="token parameter variable">-o</span> /dev/null <span class="token parameter variable">-s</span> <span class="token parameter variable">-w</span> %<span class="token punctuation">\</span><span class="token punctuation">{</span>http_code<span class="token punctuation">\</span><span class="token punctuation">}</span>  www.baidu.com<span class="token variable">)</span></span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">${http_code}</span> <span class="token parameter variable">-eq</span> <span class="token number">200</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token punctuation">(</span>log_info <span class="token string">"network is ok"</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> <span class="token variable">${TRUE}</span>
  <span class="token keyword">fi</span>
<span class="token keyword">done</span>
<span class="token punctuation">(</span>log_error <span class="token string">"network is not ok"</span><span class="token punctuation">)</span>
<span class="token builtin class-name">return</span> <span class="token variable">${FALSE}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="隐式echo"><a class="markdownIt-Anchor" href="#隐式echo"></a> 隐式echo</h4>
<p>echo 用来显示的返回函数的返回结果,例如</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将json字符串格式化树形结构 [String]&lt;-(json_string:String)</span>
<span class="token keyword">function</span> <span class="token function-name function">json_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">jsonString</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${jsonString}</span>"</span><span class="token operator">|</span>jq <span class="token builtin class-name">.</span> <span class="token comment">#jq是Shell中处理json的一个工具</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>函数中所有的echo照理都应该输出到控制台上 例如</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">json_format "{\"1\":\"one\"}"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>你会在控制台上看到如下输出</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
<span class="token property">"1"</span><span class="token operator">:</span> <span class="token string">"one"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>但是一旦你用变量接收函数的返回值,这些本该输出到控制台的结果就都会存储到你定义的变量中 例如</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">json</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>json_format <span class="token string">"{<span class="token entity" title="\&quot;">\"</span>1<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>one<span class="token entity" title="\&quot;">\"</span>}"</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${json}</span>"</span> <span class="token comment">#如果没有这句,上面的语句执行完成后,不会在控制台有任何的输出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>我们把 json_format 改造一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将json字符串格式化树形结构 [String]&lt;-(json_string:String)</span>
<span class="token keyword">function</span> <span class="token function-name function">json_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">jsonString</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token builtin class-name">echo</span> <span class="token string">"为格式化之前:<span class="token variable">${jsonString}</span>"</span> <span class="token comment">#其实新添加的这一句只是用来记录一行日志的,但是返回结果会被外层变量接收</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${jsonString}</span>"</span><span class="token operator">|</span>jq <span class="token builtin class-name">.</span> <span class="token comment">#jq是Shell中处理json的一个工具</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>echo “为格式化之前:${json_string}” 其实新添加的只一句只是用来记录一行日志的,但是json=$(json_format “{"1":"one"}”),变量 json 也会将这句话作为返回结果进行接收,但这是我不想要看到的。</p>
<p>解决这个问题需要了解重定向相关</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将json字符串格式化树形结构 [String]&lt;-(json_string:String)</span>
<span class="token keyword">function</span> <span class="token function-name function">json_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">jsonString</span><span class="token operator">=</span><span class="token variable">$1</span>
log_trace <span class="token string">"为格式化之前:<span class="token variable">${jsonString}</span>"</span> <span class="token comment">#其实新添加的只一句只是用来记录一行日志的</span>
log_info  <span class="token string">"为格式化之前:<span class="token variable">${jsonString}</span>"</span> <span class="token comment">#其实新添加的只一句只是用来记录一行日志的</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${jsonString}</span>"</span><span class="token operator">|</span>jq <span class="token builtin class-name">.</span> <span class="token comment">#jq是Shell中处理json的一个工具</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>详情请看 <a target="_blank" rel="noopener" href="http://BaseLog.sh">BaseLog.sh</a> 中对日志的处理</p>
<h2 id="关于分支"><a class="markdownIt-Anchor" href="#关于分支"></a> 关于分支</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">HEAD_KEYWORD parameters<span class="token punctuation">;</span> BODY_BEGIN
BODY_COMMANDS
BODY_END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<font color="#dd0000">
</font></blockquote>
<p>【强制】将HEAD_KEYWORD和初始化命令或者参数放在第一行；<br>
【强制】将BODY_BEGIN同样放在第一行；<br>
【强制】复合命令中的BODY部分以2个空格缩进；<br>
【强制】BODY_END部分独立一行放在最后；<br>
【推荐】parameters部分test表达式变量取值都用""包裹；<br>
【推荐】parameters部分test表达式统一使用=等符号, 在明确是数字的时候可以使用 -eq等参数；</p>
<h3 id="if"><a class="markdownIt-Anchor" href="#if"></a> if</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="while"><a class="markdownIt-Anchor" href="#while"></a> while</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">while</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">done</span>

<span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> item <span class="token punctuation">;</span><span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${item}</span>"</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token string">'file_name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="until"><a class="markdownIt-Anchor" href="#until"></a> until</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">until</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> condition <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="for"><a class="markdownIt-Anchor" href="#for"></a> for</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> statements
<span class="token keyword">done</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">item</span> <span class="token keyword">in</span> <span class="token variable">${array}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${item}</span>"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="case"><a class="markdownIt-Anchor" href="#case"></a> case</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">case</span> word <span class="token keyword">in</span>
pattern <span class="token punctuation">)</span>
  <span class="token comment">#statements</span>
  <span class="token punctuation">;</span><span class="token punctuation">;</span>
  *<span class="token punctuation">)</span>
  <span class="token comment">#statements</span>
  <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本Shell规约规定</p>
<blockquote>
<font color="#dd0000">
</font></blockquote>
<p>【强制】 if\while\until 后面的判断 使用 双中括号<code>[[]]</code></p>
<h2 id="数学计算"><a class="markdownIt-Anchor" href="#数学计算"></a> 数学计算</h2>
<p>注释 1:shell 的自加、自减操作符在使用上和 c 语言一样。-- 或者 ++ 出现在变量前面是前缀形式,先运算后赋值；-- 或者 ++ 出现在变量后面是后缀形式,先赋值后运算。<br>
本Shell规约规定</p>
<blockquote>
<font color="#dd0000">
</font></blockquote>
<p>【推荐】明确知道变量是整数,计算使用$(())包裹计算,(())内对变量的操作不用$取值<br>
正确 a=$((1+1))<br>
反例 a=$(($a++))<br>
【推荐】复杂计算使用bc计算器,前提是得安装bc计算器命令</p>
<h2 id="关于debug"><a class="markdownIt-Anchor" href="#关于debug"></a> 关于Debug</h2>
<p>详情见 <a target="_blank" rel="noopener" href="http://localhost:4000/2021/06/03/ji-zhu-zong-jie/baseshell/shell-gao-ji-bian-cheng-ji-qiao/">Shell高级编程技巧</a></p>
<h2 id="关于单元测试"><a class="markdownIt-Anchor" href="#关于单元测试"></a> 关于单元测试</h2>
<p>详情见 <a target="_blank" rel="noopener" href="http://localhost:4000/2021/06/03/ji-zhu-zong-jie/baseshell/shell-gao-ji-bian-cheng-ji-qiao/">Shell高级编程技巧</a></p>
<h1 id="命名风格"><a class="markdownIt-Anchor" href="#命名风格"></a> 命名风格</h1>
<p>本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】脚本中变量、函数、文件的命名均不能以数字、下划线、$开头,也不能以下划线或者$结尾<br>
反例: _name / __name / <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi mathvariant="normal">/</mi><mi>n</mi><mi>a</mi><mi>m</mi><msub><mi>e</mi><mi mathvariant="normal">/</mi></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">name / name_ / name</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3551999999999999em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord">/</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">/</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span></span></span> / 5name<br>
说明: $作为Shell语言的取值符号,其他命名约束参考Java规约。</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】代码中的命名严禁使用拼音与英文混合的方式,更不允许直接使用中文的方式。<br>
正例:alibaba / taobao / youku / hangzhou 等国际通用的名称,可视同英文。<br>
说明:正确的英文拼写和语法可以让阅读者易于理解,避免歧义。注意,即使纯拼音命名方式 也要避免采用。</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】参数名、局部变量都统一使用 lowerCamelCase 风格,必须遵从 驼峰形式。<br>
正例: localValue / errMsg / userName</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【推荐】使用下划线分割函数命名,都统一使用 lowerCamelCase 风格,必须遵从 驼峰形式。<br>
正例:getUserName() / log_info() / map_add()<br>
说明: 纯用下划线会使得命名很长,纯用驼峰又无法将函数聚类<br>
get_user_english_name()  vs getUserEnglishName()<br>
log_info() vs logInfo()<br>
map_add() vs mapAdd()<br>
log_info “xxx” 在调用的时候类比于Java 的<code>log.info("xxx")</code></font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】文件名 UpperCamelCase 风格,首字母大写的驼峰形式<br>
正例:BaseLog.sh / <a target="_blank" rel="noopener" href="http://BaseString.sh">BaseString.sh</a><br>
说明:类比Java的类,我们把相同功能的函数抽象到一个脚本文件中,留待后续其他脚本引用。随着我们写的脚本日渐增多<br>
我们很有必要分门别类的将它们聚集到一个文本文件中,一是方便后续查阅,而是方便后续调用</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【强制】常量命名全部大写,单词间用下划线隔开,力求语义表达完整清楚,不要嫌名字长。<br>
正例:MAX_STOCK_COUNT 反例:MAX_COUNT</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【推荐】文件夹名字大写<br>
【强制】文件名以 .sh 结尾<br>
说明:虽然不用.sh结尾或者以任何其他新式结尾都可以运行,但是以 .sh结尾可以一眼看出就是脚本文件</font></p>
</blockquote>
<p><a name="end"></a><br>
本Shell规约规定</p>
<blockquote>
<p><font color="#dd0000">【强制】使用两个空格进行缩进,不适用tab缩进</font></p>
</blockquote>
<blockquote>
<p><font color="#dd0000">【推荐】不在一行的时候使用 <code>\</code> 进行换行,使用 <code>\</code> 换行的原则是整齐美观</font></p>
</blockquote>
<p>例子:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token comment"># 脚本使用帮助文档 []&lt;-()</span>
<span class="token function-name function">manual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token function">cat</span> <span class="token string">"<span class="token variable">$0</span>"</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"less <span class="token entity" title="\&quot;">\"</span>\<span class="token variable">$0</span><span class="token entity" title="\&quot;">\"</span>"</span> <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-B1</span> <span class="token string">"function "</span>   <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"<span class="token entity" title="\\">\\</span>--"</span>         <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">"s/function //g"</span>   <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">"s/(){//g"</span>         <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">"s/#//g"</span>           <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">sed</span> <span class="token string">'N;s/\n/ /'</span>        <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">column</span> <span class="token parameter variable">-t</span>              <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $1,$3,$2}'</span> <span class="token punctuation">\</span>
        <span class="token operator">|</span><span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-name function">search_user_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>httpclient_get <span class="token parameter variable">--cookie</span> <span class="token string">"<span class="token variable">${cookie}</span>"</span> <span class="token punctuation">\</span>
                                       <span class="token string">"<span class="token variable">${url}</span>/userName=<span class="token variable">${user_name}</span>"</span><span class="token variable">)</span></span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="使用方法"><a class="markdownIt-Anchor" href="#使用方法"></a> <code>()、(())、[]、[[]]、{}</code> 使用方法</h1>
<h2 id="的用法"><a class="markdownIt-Anchor" href="#的用法"></a> ( ) 的用法</h2>
<h3 id="命令组"><a class="markdownIt-Anchor" href="#命令组"></a> 命令组</h3>
<p>括号中的命令将会新开一个子shell顺序执行,所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号’;'隔开,最后一个命令可以没有分号,各命令和括号之间不必有空格。</p>
<h3 id="命令替换"><a class="markdownIt-Anchor" href="#命令替换"></a> 命令替换</h3>
<p>等同于 `command`,shell扫描一遍命令行,发现了$(command)结构,便将$(command)中的command执行一次,得到其标准输出,再将此输出放到原来命令。</p>
<h3 id="用于初始化数组"><a class="markdownIt-Anchor" href="#用于初始化数组"></a> 用于初始化数组</h3>
<p>如：array=(a b c d e f)</p>
<h2 id="的用法-2"><a class="markdownIt-Anchor" href="#的用法-2"></a> (( )) 的用法</h2>
<ol>
<li>
<p>这种扩展计算是整数型的计算,不支持浮点型。((exp))结构扩展并计算一个算术表达式的值,如果表达式的结果为0,那么返回的退出状态码为1,或者是"false",而一个非零值的表达式所返回的退出状态码将为0,或者是"true"。若是逻辑判断,表达式exp为真则为1,假则为0。</p>
</li>
<li>
<p>只要括号中的运算符、表达式符合C语言运算规则,都可用在$((exp))中,甚至是三目运算符。作不同进位(如二进制、八进制、十六进制)运算时,输出结果全都自动转化成了十进制。如：echo $((16#5f)) 结果为95 (16进制转十进制)<br>
单纯用 (( )) 也可重定义变量值,比如 a=5; ((a++))可将 $a 重定义为6<br>
常用于算术运算比较,双括号中的变量可以不使用$符号前缀。括号内支持多个表达式用逗号分开。只要括号中的表达式符合C语言运算规则,比如可以直接使用for((i=0;i&lt;5;i++)), 如果不使用双括号, 则为for i in <code>seq 0 4</code>或者for i in {0…4}。再如可以直接使用if (($i&lt;5)), 如果不使用双括号, 则为if [ $i -lt 5 ]。</p>
</li>
</ol>
<h2 id="的用法-3"><a class="markdownIt-Anchor" href="#的用法-3"></a> [ ] 的用法</h2>
<ol>
<li>bash 的内部命令,[和test是等同的。如果我们不用绝对路径指明,通常我们用的都是bash自带的命令。if/test结构中的左中括号是调用test的命令标识,右中括号是关闭条件判断的。这个命令把它的参数作为比较表达式或者作为文件测试,并且根据比较的结果来返回一个退出状态码。if/test结构中并不是必须右中括号,但是新版的Bash中要求必须这样。</li>
<li>test和[]中可用的比较运算符只有==和!=,两者都是用于字符串比较的,不可用于整数比较,整数比较只能使用-eq,-gt这种形式。无论是字符串比较还是整数比较都不支持大于号小于号。如果实在想用,对于字符串比较可以使用转义形式,如果比较"ab"和"bc"：[ ab &lt; bc ],结果为真,也就是返回状态为0。[ ]中的逻辑与和逻辑或使用-a 和-o 表示。</li>
<li>字符范围。用作正则表达式的一部分,描述一个匹配的字符范围。作为test用途的中括号内不能使用正则。</li>
<li>在一个array 结构的上下文中,中括号用来引用数组中每个元素的编号。</li>
</ol>
<h2 id="的用法-4"><a class="markdownIt-Anchor" href="#的用法-4"></a> [[ ]] 的用法</h2>
<ol>
<li>[[是 bash 程序语言的关键字。并不是一个命令,[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割,但是会发生参数扩展和命令替换。</li>
<li>支持字符串的模式匹配,使用=~操作符时甚至支持shell的正则表达式。字符串比较时可以把右边的作为一个模式,而不仅仅是一个字符串,比如[[ hello == hell? ]],结果为真。[[ ]] 中匹配字符串或通配符,不需要引号。</li>
<li>使用[[ … ]]条件判断结构,而不是[ … ],能够防止脚本中的许多逻辑错误。比如,&amp;&amp;、||、&lt;和&gt; 操作符能够正常存在于[[ ]]条件判断结构中,但是如果出现在[ ]结构中的话,会报错。比如可以直接使用if [[ $a != 1 &amp;&amp; $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] &amp;&amp; [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。</li>
<li>bash把双中括号中的表达式看作一个单独的元素,并返回一个退出状态码。</li>
</ol>
<h2 id="的用法-5"><a class="markdownIt-Anchor" href="#的用法-5"></a> { } 的用法</h2>
<ol>
<li>对大括号{}中的以逗号分割的文件列表进行拓展。如 touch {a,b}.txt 结果为a.txt b.txt。</li>
<li>对大括号{}中以点点（…）分割的顺序文件列表起拓展作用,如：touch {a…d}.txt 结果为a.txt b.txt c.txt d.txt。</li>
<li>代码块,又被称为内部组,这个结构事实上创建了一个匿名函数 。<br>
与()中的命令不同,{}内的命令不会新开一个子shell运行,即脚本余下部分仍可使用括号内变量。括号内的命令间用分号隔开,最后一个也必须有分号。{}的第一个命令和左括号之间必须要有一个空格。</li>
</ol>
<h1 id="字符串常用操作"><a class="markdownIt-Anchor" href="#字符串常用操作"></a> 字符串常用操作</h1>
<h2 id="特殊的替换结构"><a class="markdownIt-Anchor" href="#特殊的替换结构"></a> 特殊的替换结构</h2>
<ol>
<li><code>${var:-string}</code> 和 <code>${var:=string}</code>:若变量var为空,则用在命令行中用string来替换 <code>${var:-string}</code>,否则变量var不为空时,则用变量var的值来替换 <code>${var:-string}</code>；对于<code>${var:=string}</code> 的替换规则和 <code>${var:-string}</code> 是一样的,所不同之处是<code>${var:=string}</code>若var为空时,用string替换 <code>${var:=string}</code> 的同时,把string赋给变量var,<code>${var:=string}</code> 很常用的一种用法是,判断某个变量是否赋值,没有的话则给它赋上一个默认值。</li>
<li><code>${var:+string}</code> 的替换规则和上面的相反,即只有当var不是空的时候才替换成string,若var为空时则不替换或者说是替换成变量 var的值,即空值。</li>
<li><code>${var:?string}</code>替换规则为：若变量var不为空,则用变量var的值来替换${var:?string}；若变量var为空,则把string输出到标准错误中,并从脚本中退出。我们可利用此特性来检查是否设置了变量的值。</li>
<li><code>${variable%pattern}</code>这种模式,shell在variable中查找,看它是否以给的模式pattern结尾,如果是,就从命令行把variable中的内容去掉右边最短的匹配模式</li>
<li><code>${variable%%pattern}</code>这种模式,shell在variable中查找,看它是否以给的模式pattern结尾,如果是,就从命令行把variable中的内容去掉右边最长的匹配模式</li>
<li><code>${variable#pattern}</code>这种模式,shell在variable中查找,看它是否以给的模式pattern开始,如果是,就从命令行把variable中的内容去掉左边最短的匹配模式</li>
<li><code>${variable##pattern}</code>这种模式,shell在variable中查找,看它是否以给的模式pattern结尾,如果是,就从命令行把variable中的内容去掉右边最长的匹配模式<br>
这四种模式中都不会改变variable的值,其中,只有在pattern中使用了匹配符号时,%和%%,#和##才有区别。结构中的pattern支持通配符,表示零个或多个任意字符,?表示仅与一个任意字符匹配,[…]表示匹配中括号里面的字符,[!..]表示不匹配中括号里面的字符。**</li>
</ol>
<h2 id="字符串提取和替换"><a class="markdownIt-Anchor" href="#字符串提取和替换"></a> 字符串提取和替换</h2>
<ol>
<li><code>${var:num}</code>,shell在var中提取第num个字符到末尾的所有字符。若num为正数,从左边0处开始；若num为负数,从右边开始提取字串,但必须使用在冒号后面加空格或一个数字或整个num加上括号,如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>v</mi><mi>a</mi><mi>r</mi><mo>:</mo><mo>−</mo><mn>2</mn></mrow><mtext>、</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">{var: -2}、`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mord">2</span></span><span class="mord cjk_fallback">、</span><span class="mord">‘</span></span></span></span>{var:1-3}<code>或</code>${var:(-2)}`。</li>
<li><code>${var:num1:num2}</code>,num1是位置,num2是长度。表示从<code>$var</code>字符串的第<code>$num1</code>个位置开始提取长度为<code>$num2</code>的子串。不能为负数。</li>
<li><code>${var/pattern1/pattern2}</code>表示将var字符串的第一个匹配的pattern1替换为另一个pattern2。</li>
<li><code>${var//pattern1/pattern2}</code>表示将<code>var</code>字符串中的所有能匹配的pattern1替换为另一个pattern2。</li>
</ol>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%8E%9F%E5%88%9B/">
                                    <span class="chip bg-color">原创</span>
                                </a>
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                                <a href="/tags/%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD/">
                                    <span class="chip bg-color">未完待续</span>
                                </a>
                            
                                <a href="/tags/Shell/">
                                    <span class="chip bg-color">Shell</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'zpykYxqrLC4qVar5tL3t0MAL-gzGzoHsz',
        appKey: '3LhmIMSf9HYX5VXhD21hiPPG',
        serverURLs: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/08/10/java/java-she-ji-mo-shi/chong-xie-she-ji-mo-shi-yong-lshi-xian-dan-li-mo-shi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="重写设计模式-用λ实现单例模式">
                        
                        <span class="card-title">重写设计模式-用λ实现单例模式</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-08-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/JAVA/" class="post-category">
                                    JAVA
                                </a>
                            
                            <a href="/categories/JAVA/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-category">
                                    Java设计模式
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%8E%9F%E5%88%9B/">
                        <span class="chip bg-color">原创</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/04/15/linux/shell/shu-ju-jie-gou-suan-fa/shell-xi-er-pai-xu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="用shell教你搞定各种排序算法-希尔排序">
                        
                        <span class="card-title">用shell教你搞定各种排序算法-希尔排序</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            希尔排序
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-04-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux/" class="post-category">
                                    Linux
                                </a>
                            
                            <a href="/categories/Linux/Shell/" class="post-category">
                                    Shell
                                </a>
                            
                            <a href="/categories/Linux/Shell/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95/" class="post-category">
                                    数据结构算法
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%8E%9F%E5%88%9B/">
                        <span class="chip bg-color">原创</span>
                    </a>
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/Shell/">
                        <span class="chip bg-color">Shell</span>
                    </a>
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95/">
                        <span class="chip bg-color">数据结构算法</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('300')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 涓涓细流<br />'
            + '文章作者: 陈尚<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">陈尚</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">165.2k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/chen-shang" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2414973330@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2414973330" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2414973330" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
	<span id="jinrishici-sentence"></span>
        <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    
        <!-- <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script> -->
        <script src='/libs/mermaid/mermaid.min.js'></script>
        <script>
          if (window.mermaid) {
            mermaid.initialize({theme: 'forest'});
          }
        </script>
    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?f34c6ca18e751cd090a8864b66dda7fd";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>

</html>
